#!/bin/sh
# Git pre-push hook to rebuild and stage README.md using PowerShell automation.
# Works on Windows (via Git Bash), Linux, and macOS.

if ! command -v pwsh >/dev/null 2>&1; then
  echo "❌ PowerShell (pwsh) not found in PATH. Install PowerShell 7+ to continue."
  exit 1
fi

# Get the absolute path to this hook’s directory (resolves symlinks too)
HOOK_DIR="$(cd "$(dirname "$0")" && pwd)"

# Move two levels up from .git/hooks to repo root, then into /Private
SCRIPT_PATH="$HOOK_DIR/../../Private/Update-ReadmeOnPush.ps1"

# Verify the script exists before attempting to run
if [ ! -f "$SCRIPT_PATH" ]; then
  echo "❌ Could not find $SCRIPT_PATH"
  echo "Push aborted."
  exit 1
fi

# Run the PowerShell automation
pwsh -NoProfile -ExecutionPolicy Bypass -File "$SCRIPT_PATH"
STATUS=$?

if [ $STATUS -ne 0 ]; then
  echo "❌ Update-ReadmeOnPush.ps1 failed with exit code $STATUS"
  echo "Push aborted."
  exit 1
fi

echo "✅ README.md verified/updated successfully. Proceeding with push."
exit 0

